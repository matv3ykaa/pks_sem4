<Window x:Class="LibraryApp.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:LibraryApp.ViewModels"
        xmlns:conv="clr-namespace:LibraryApp.Converters"
        Title="Управление библиотекой" Height="700" Width="1100"
        MinHeight="500" MinWidth="800"
        WindowStartupLocation="CenterScreen"
        Background="#F8FAFC">
    <Window.DataContext>
        <vm:MainViewModel/>
    </Window.DataContext>
    <Window.Resources>
        <conv:NullToBoolConverter x:Key="NullToBool"/>
    </Window.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="60"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="36"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="#2563EB">
            <Grid Margin="20,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Text="Библиотека" Foreground="White" FontSize="22" FontWeight="Bold"
                           VerticalAlignment="Center"/>
                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                    <Button Content="Авторы" Margin="0,0,8,0" Style="{StaticResource SecondaryButton}"
                            Command="{Binding ManageAuthorsCommand}"/>
                    <Button Content="Жанры" Style="{StaticResource SecondaryButton}"
                            Command="{Binding ManageGenresCommand}"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Filter / Search Panel -->
        <Border Grid.Row="1" Background="White" BorderBrush="{StaticResource BorderBrush}"
                BorderThickness="0,0,0,1" Padding="16,12">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="180"/>
                    <ColumnDefinition Width="180"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Search -->
                <StackPanel Grid.Column="0" Margin="0,0,12,0">
                    <Label Content="Поиск по названию"/>
                    <TextBox Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"/>
                </StackPanel>

                <!-- Filter Author -->
                <StackPanel Grid.Column="1" Margin="0,0,12,0">
                    <Label Content="Автор"/>
                    <ComboBox ItemsSource="{Binding Authors}"
                              SelectedItem="{Binding FilterAuthor}"
                              DisplayMemberPath="FullName"
                              VerticalContentAlignment="Center"/>
                </StackPanel>

                <!-- Filter Genre -->
                <StackPanel Grid.Column="2" Margin="0,0,12,0">
                    <Label Content="Жанр"/>
                    <ComboBox ItemsSource="{Binding Genres}"
                              SelectedItem="{Binding FilterGenre}"
                              DisplayMemberPath="Name"
                              VerticalContentAlignment="Center"/>
                </StackPanel>

                <!-- Clear Filters -->
                <StackPanel Grid.Column="3" VerticalAlignment="Bottom" Margin="0,0,8,0">
                    <Button Content="✕ Сбросить" Style="{StaticResource SecondaryButton}"
                            Command="{Binding ClearFiltersCommand}"/>
                </StackPanel>

                <!-- Add -->
                <StackPanel Grid.Column="4" VerticalAlignment="Bottom" Margin="0,0,8,0">
                    <Button Content="+ Добавить" Style="{StaticResource PrimaryButton}"
                            Command="{Binding AddBookCommand}"/>
                </StackPanel>

                <!-- Edit -->
                <StackPanel Grid.Column="5" VerticalAlignment="Bottom" Margin="0,0,8,0">
                    <Button Content="Изменить" Style="{StaticResource SuccessButton}"
                            Command="{Binding EditBookCommand}"
                            IsEnabled="{Binding SelectedBook, Converter={StaticResource NullToBool}}"/>
                </StackPanel>

                <!-- Delete -->
                <StackPanel Grid.Column="6" VerticalAlignment="Bottom">
                    <Button Content="Удалить" Style="{StaticResource DangerButton}"
                            Command="{Binding DeleteBookCommand}"
                            IsEnabled="{Binding SelectedBook, Converter={StaticResource NullToBool}}"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- DataGrid -->
        <DataGrid Grid.Row="2" Margin="16,12,16,0"
                  ItemsSource="{Binding Books}"
                  SelectedItem="{Binding SelectedBook}"
                  ScrollViewer.VerticalScrollBarVisibility="Auto">
            <DataGrid.Columns>
                <DataGridTextColumn Header="Название" Binding="{Binding Title}" Width="2*"/>
                <DataGridTextColumn Header="Автор" Binding="{Binding Author.FullName}" Width="*"/>
                <DataGridTextColumn Header="Жанр" Binding="{Binding Genre.Name}" Width="120"/>
                <DataGridTextColumn Header="Год" Binding="{Binding PublishYear}" Width="70">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="HorizontalAlignment" Value="Center"/>
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>
                <DataGridTextColumn Header="ISBN" Binding="{Binding ISBN}" Width="140"/>
                <DataGridTextColumn Header="В наличии" Binding="{Binding QuantityInStock}" Width="90">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="HorizontalAlignment" Value="Center"/>
                            <Setter Property="FontWeight" Value="SemiBold"/>
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>
            </DataGrid.Columns>
        </DataGrid>

        <!-- Status Bar -->
        <Border Grid.Row="3" Background="#F1F5F9" BorderBrush="{StaticResource BorderBrush}"
                BorderThickness="0,1,0,0" Padding="16,0">
            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                <TextBlock Text="Книг найдено: " Foreground="#6B7280" FontSize="12"/>
                <TextBlock Text="{Binding Books.Count}" Foreground="#374151" FontWeight="SemiBold" FontSize="12"/>
                <TextBlock Text="   |   Всего экземпляров: " Foreground="#6B7280" FontSize="12"/>
                <TextBlock Text="{Binding TotalBooks}" Foreground="#374151" FontWeight="SemiBold" FontSize="12"/>
            </StackPanel>
        </Border>
    </Grid>
</Window>
